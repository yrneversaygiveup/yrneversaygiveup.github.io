<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>雨夜</title><meta name="author" content="YRain"><meta name="copyright" content="YRain"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="referrer" content="no-referrer"><meta name="description" content="别被大雨湿了心">
<meta property="og:type" content="website">
<meta property="og:title" content="雨夜">
<meta property="og:url" content="http://yrain11.com/page/4/index.html">
<meta property="og:site_name" content="雨夜">
<meta property="og:description" content="别被大雨湿了心">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yrain11.com/img/xier.jpg">
<meta property="article:author" content="YRain">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yrain11.com/img/xier.jpg"><link rel="shortcut icon" href="/img/fav.png"><link rel="canonical" href="http://yrain11.com/page/4/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: YRain","link":"链接: ","source":"来源: 雨夜","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '雨夜',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-11-19 23:15:47'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/xier.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://yrain11.oss-cn-hangzhou.aliyuncs.com/pictures/202311192314964.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="雨夜"><span class="site-name">雨夜</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">雨夜</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/yrneversaygiveup" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:13732224484yr@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/posts/1d0f563b.html" title="边缘检测"><img class="post-bg" src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="边缘检测"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/1d0f563b.html" title="边缘检测">边缘检测</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-09T01:15:35.000Z" title="发表于 2023-09-09 09:15:35">2023-09-09</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-02T15:37:53.451Z" title="更新于 2023-11-02 23:37:53">2023-11-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/">unity shader 入门精要总结</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%B1%8F%E5%B9%95%E5%90%8E%E5%A4%84%E7%90%86/">第十二章：屏幕后处理</a></span></div><div class="content">图像处理中的卷积其实就是用卷积核对一张图像的像素进行处理，不同卷积核所处理的最终效果不同。
其实也叫算子。这部分内容请自学相关内容。
使用sobal算子计算边缘sobal算子一般是两个3x3的算子，一个用来计算上下之间的像素差，一个计算左右的像素差，像素差越大，该像素就越白或越黑。两个得到的梯度值通过平方和开根号得到最终的梯度值。
脚本编写其实不难看出，脚本的作用主要就是调用OnRenderImage和传入控制的参数，真正的处理需要放到shader当中。
//EdgeDetection.cs
using UnityEngine;
using System.Collections;

public class EdgeDetection : PostEffectsBase &#123;

    public Shader edgeDetectShader;
    private Material edgeDetectMaterial = null;
    public Material material &#123;  
        get &#123;
            ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/e53f72a2.html" title="运动模糊"><img class="post-bg" src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="运动模糊"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/e53f72a2.html" title="运动模糊">运动模糊</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-09T01:15:35.000Z" title="发表于 2023-09-09 09:15:35">2023-09-09</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-02T15:37:53.445Z" title="更新于 2023-11-02 23:37:53">2023-11-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/">unity shader 入门精要总结</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%B1%8F%E5%B9%95%E5%90%8E%E5%A4%84%E7%90%86/">第十二章：屏幕后处理</a></span></div><div class="content">什么是运动模糊在摄像机曝光的时候，拍摄场景发生变换，就会产生模糊的画面。运动模糊可以让物体运动看起来更加真实平滑。
实现方法1:利用一块累计缓存accumulation buffer,用来混合多张连续的图像，当物体快速移动，我们取多张图像的平均值作为最后的图像。
缺点：性能消耗大，需要在同一帧渲染多次场景。
实现方法2：使用速度缓存velocity buffer，这个缓存存储像素当前的运动速度，利用该值决定模糊的方向。
方法1实现不需要渲染多次场景，只需要保存之前的渲染结果，不断把当前的渲染图像叠加之前的渲染图像，产生一种运动轨迹的视角效果。可以提高性能，但是模糊效果肯定不如之前的效果。
脚本using UnityEngine;
using System.Collections;

public class MotionBlur : PostEffectsBase &#123;

    public Shader motionBlurShader;
    private Material motionBlurMaterial = null;

    public Material ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/a45cef5f.html" title="高斯模糊"><img class="post-bg" src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="高斯模糊"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/a45cef5f.html" title="高斯模糊">高斯模糊</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-09T01:15:35.000Z" title="发表于 2023-09-09 09:15:35">2023-09-09</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-02T15:37:53.446Z" title="更新于 2023-11-02 23:37:53">2023-11-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/">unity shader 入门精要总结</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%B1%8F%E5%B9%95%E5%90%8E%E5%A4%84%E7%90%86/">第十二章：屏幕后处理</a></span></div><div class="content">原理利用另一个算子，均值滤波器，这个算子的作用可以平均邻域内的像素，从而达到模糊的效果
高斯滤波：很好的模拟了邻域每个像素对当前像素的影响程度：距离越近，影响越大。高斯核的维数越高，模糊程度越大。
实现把5x5的高斯核变成横向和纵向的两个一位高斯核，用两个pass来得到最后的图像，通过图像缩放提高性能，通过应用次数来控制模糊程度
脚本类：
using UnityEngine;
using System.Collections;

public class GaussianBlur : PostEffectsBase &#123;

    public Shader gaussianBlurShader;
    private Material gaussianBlurMaterial = null;

    public Material material &#123;  
        get &#123;
            gaussianBlurMaterial = CheckShaderAndCreateMaterial(gaussianBlurShader, g ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/d872e91.html" title="3.1 UnityShader概述"><img class="post-bg" src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="3.1 UnityShader概述"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/d872e91.html" title="3.1 UnityShader概述">3.1 UnityShader概述</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-08T09:03:35.000Z" title="发表于 2023-09-08 17:03:35">2023-09-08</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-02T15:37:53.385Z" title="更新于 2023-11-02 23:37:53">2023-11-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/">unity shader 入门精要总结</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E4%B8%89%E7%AB%A0/">第三章</a></span></div><div class="content">ShaderLab* 
</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/9805665e.html" title="5.6 小心平台差异"><img class="post-bg" src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="5.6 小心平台差异"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/9805665e.html" title="5.6 小心平台差异">5.6 小心平台差异</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-08T09:03:35.000Z" title="发表于 2023-09-08 17:03:35">2023-09-08</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-02T15:37:53.402Z" title="更新于 2023-11-02 23:37:53">2023-11-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/">unity shader 入门精要总结</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E4%BA%94%E7%AB%A0/">第五章</a></span></div><div class="content">渲染纹理的坐标差异前提：我们需要使用渲染纹理（render texture）保存渲染结果时，就要注意openGL和DirectX的差异
结果：unity会在背后帮助处理，以达到不同平台的一致性
特殊情况：开启抗锯齿后（edit-project settings-quality-anti alising）,碰到具体问题时再详细了解（p115-p116）
shader 的语法差异shader的语义差异</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/b4510626.html" title="2.1.2 什么是渲染流水线"><img class="post-bg" src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2.1.2 什么是渲染流水线"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/b4510626.html" title="2.1.2 什么是渲染流水线">2.1.2 什么是渲染流水线</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-08T07:11:35.000Z" title="发表于 2023-09-08 15:11:35">2023-09-08</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-02T15:37:53.405Z" title="更新于 2023-11-02 23:37:53">2023-11-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/">unity shader 入门精要总结</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E4%BA%8C%E7%AB%A0/">第二章</a></span></div><div class="content">渲染流水线工作任务：将三维场景渲染（生成）为一张二维图像。

渲染流程：

应用阶段(Application)：开发者决定

准备场景数据（模型，相机，光源等）
culling，剔除不可见物体
设置渲染状态（材质，纹理，shader）
输出渲染图元（几何信息）


几何阶段(Geometry)：GPU上

绘制什么
如何绘制
在哪绘制

把顶点坐标变换到屏幕空间，输出屏幕空间的二维顶点坐标，深度值，着色等信息。

光栅化阶段(Rasterizer)：GPU

根据数据渲染最终图像
像素化（个人理解）





</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/ec3c3a35.html" title="2.2 应用阶段"><img class="post-bg" src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2.2 应用阶段"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/ec3c3a35.html" title="2.2 应用阶段">2.2 应用阶段</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-08T07:11:35.000Z" title="发表于 2023-09-08 15:11:35">2023-09-08</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-02T15:37:53.421Z" title="更新于 2023-11-02 23:37:53">2023-11-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/">unity shader 入门精要总结</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E4%BA%8C%E7%AB%A0/">第二章</a></span></div><div class="content">CPU和GPU的通讯（应用阶段）把数据加载到显存
数据从硬盘加载到系统内存（RAM）
RAM把数据加载到显卡显存上：
显卡对显存访问更快
大多数显卡没有RAM的直接访问权利



设置渲染状态什么是渲染状态？答：这些状态定义了网格是如何被渲染（形状，颜色，材质等属性）
调用Draw Call（渲染命令）
发起方：CPU。接受方：GPU
指向一个需要被渲染的图元（primitives）列表
GPU收到指令后，会根据渲染状态渲染所指定的图元列表
渲染所需的计算过程为GPU流水线

</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/945c8b95.html" title="2.5 什么是shader"><img class="post-bg" src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2.5 什么是shader"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/945c8b95.html" title="2.5 什么是shader">2.5 什么是shader</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-08T07:11:35.000Z" title="发表于 2023-09-08 15:11:35">2023-09-08</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-02T15:37:53.419Z" title="更新于 2023-11-02 23:37:53">2023-11-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/">unity shader 入门精要总结</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E4%BA%8C%E7%AB%A0/">第二章</a></span></div><div class="content">Shader究竟是什么
GPU流水线上高度可编程的阶段
重点是顶点着色器控制顶点变换和传递数据，片元着色器进行逐片元的渲染。S

</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/aacc2f5b.html" title="2.3 GPU流水线"><img class="post-bg" src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2.3 GPU流水线"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/aacc2f5b.html" title="2.3 GPU流水线">2.3 GPU流水线</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-08T07:11:35.000Z" title="发表于 2023-09-08 15:11:35">2023-09-08</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-02T15:37:53.418Z" title="更新于 2023-11-02 23:37:53">2023-11-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/">unity shader 入门精要总结</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E4%BA%8C%E7%AB%A0/">第二章</a></span></div><div class="content">GPU流水线说人话：几何阶段+光栅化阶

几何阶段
顶点着色器
vertex shader:完全可编程。实现顶点的空间变换，顶点着色。

曲面细分着色器
Tessellation Shader:可选着色器。用于细分图元

几何着色器
Geometry Shader:可选着色器。用于执行逐图元的着色操作，或产生更多图元。

裁剪
clipping:可配置。裁剪掉不在摄像机视野内的顶点和剔除某些面片
针对对象：部分在视野内的图元（不可编程，但可以自定一个裁剪操作）

屏幕映射
screen mapping:不可配置和编程的。用于把每个图元的坐标转换到屏幕坐标系当中。
输入：三维坐标（范围在单位正方体：即经过正交投影后的三维坐标）
需要注意OpenGL和DirectX屏幕坐标系的不同：OpenGL在左下，DirectX在左上。


顶点着色器输入：CPU
处理单位：顶点（每个顶点调用一次顶点着色器）
限制：无法创建和销毁顶点，无法获得两个顶点的相关联系（逐顶点计算）
优点：处理速度快（不用考虑关联性，GPU狂喜）
工作：

坐标变换：把顶点坐标从模型空间转换到齐次裁剪空间，以及其他需求所需的 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/4a17b156.html" title="Hello World"><img class="post-bg" src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/4a17b156.html" title="Hello World">Hello World</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-07T13:40:05.564Z" title="发表于 2023-09-07 21:40:05">2023-09-07</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-02T15:37:53.365Z" title="更新于 2023-11-02 23:37:53">2023-11-02</time></span></div><div class="content">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.
Quick StartCreate a new post$ hexo new &quot;My New Post&quot;

More info: Writing
Run server$ hexo server

More info: Server
Generate static files$ hexo generate

More info: Generating
Deploy to remote sites$ hexo deploy

More info: Deployment
</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/3/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/#content-inner">3</a><span class="page-number current">4</span></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/xier.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">YRain</div><div class="author-info__description">别被大雨湿了心</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/yrneversaygiveup" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:13732224484yr@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/4055e175.html" title="常用函数接口"><img src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="常用函数接口"/></a><div class="content"><a class="title" href="/posts/4055e175.html" title="常用函数接口">常用函数接口</a><time datetime="2023-09-09T01:15:35.000Z" title="发表于 2023-09-09 09:15:35">2023-09-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/15a2f545.html" title="7.1 单张纹理"><img src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="7.1 单张纹理"/></a><div class="content"><a class="title" href="/posts/15a2f545.html" title="7.1 单张纹理">7.1 单张纹理</a><time datetime="2023-09-09T01:15:35.000Z" title="发表于 2023-09-09 09:15:35">2023-09-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/529bf6c6.html" title="7.2 凹凸纹理"><img src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="7.2 凹凸纹理"/></a><div class="content"><a class="title" href="/posts/529bf6c6.html" title="7.2 凹凸纹理">7.2 凹凸纹理</a><time datetime="2023-09-09T01:15:35.000Z" title="发表于 2023-09-09 09:15:35">2023-09-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ac8870a9.html" title="7.3 渐变纹理"><img src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="7.3 渐变纹理"/></a><div class="content"><a class="title" href="/posts/ac8870a9.html" title="7.3 渐变纹理">7.3 渐变纹理</a><time datetime="2023-09-09T01:15:35.000Z" title="发表于 2023-09-09 09:15:35">2023-09-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/79c6506a.html" title="7.4 遮罩纹理"><img src="https://gitee.com/yurain11/drawing-bed/raw/master/blog/fengmian1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="7.4 遮罩纹理"/></a><div class="content"><a class="title" href="/posts/79c6506a.html" title="7.4 遮罩纹理">7.4 遮罩纹理</a><time datetime="2023-09-09T01:15:35.000Z" title="发表于 2023-09-09 09:15:35">2023-09-09</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/"><span class="card-category-list-name">unity shader 入门精要总结</span><span class="card-category-list-count">39</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E4%B8%83%E7%AB%A0%EF%BC%9A%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/"><span class="card-category-list-name">第七章：基础纹理</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E4%B8%89%E7%AB%A0/"><span class="card-category-list-name">第三章</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E4%B9%9D%E7%AB%A0%EF%BC%9A%E6%9B%B4%E5%A4%8D%E6%9D%82%E7%9A%84%E5%85%89%E7%85%A7/"><span class="card-category-list-name">第九章：更复杂的光照</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E4%BA%8C%E7%AB%A0/"><span class="card-category-list-name">第二章</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E4%BA%94%E7%AB%A0/"><span class="card-category-list-name">第五章</span><span class="card-category-list-count">6</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E5%85%AB%E7%AB%A0%EF%BC%9A%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/"><span class="card-category-list-name">第八章：透明效果</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/unity-shader-%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%E6%80%BB%E7%BB%93/%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9Aunity%E5%9F%BA%E7%A1%80%E5%85%89%E7%85%A7/"><span class="card-category-list-name">第六章：unity基础光照</span><span class="card-category-list-count">3</span></a></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/%E6%B8%B2%E6%9F%93%E8%B7%AF%E5%BE%84/" style="font-size: 1.1em; color: #999">渲染路径</a> <a href="/tags/%E6%B8%B2%E6%9F%93%E5%B9%B3%E5%8F%B0%E5%B7%AE%E5%BC%82/" style="font-size: 1.1em; color: #999">渲染平台差异</a> <a href="/tags/%E5%85%89%E7%85%A7/" style="font-size: 1.18em; color: #999ca1">光照</a> <a href="/tags/hlsl/" style="font-size: 1.1em; color: #999">hlsl</a> <a href="/tags/ShaderLab/" style="font-size: 1.5em; color: #99a9bf">ShaderLab</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/" style="font-size: 1.18em; color: #999ca1">计算机图形学</a> <a href="/tags/%E9%98%B4%E5%BD%B1/" style="font-size: 1.1em; color: #999">阴影</a> <a href="/tags/shaderLab/" style="font-size: 1.1em; color: #999">shaderLab</a> <a href="/tags/%E9%80%8F%E6%98%8E%E6%95%88%E6%9E%9C/" style="font-size: 1.26em; color: #999fa8">透明效果</a> <a href="/tags/%E5%8A%A8%E7%94%BB/" style="font-size: 1.18em; color: #999ca1">动画</a> <a href="/tags/%E7%BA%B9%E7%90%86/" style="font-size: 1.26em; color: #999fa8">纹理</a> <a href="/tags/%E6%B8%B2%E6%9F%93%E6%B5%81%E6%B0%B4%E7%BA%BF/" style="font-size: 1.26em; color: #999fa8">渲染流水线</a> <a href="/tags/%E5%B1%8F%E5%B9%95%E5%90%8E%E5%A4%84%E7%90%86/" style="font-size: 1.34em; color: #99a3b0">屏幕后处理</a> <a href="/tags/unity/" style="font-size: 1.42em; color: #99a6b7">unity</a> <a href="/tags/hexo/" style="font-size: 1.1em; color: #999">hexo</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><span class="card-archive-list-count">40</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">40</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-11-19T15:15:47.130Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By YRain</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>window.typedJSFn = {
  init: (str) => {
    window.typed = new Typed('#subtitle', Object.assign({
      strings: str,
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50,
    }, ))
  },
  run: (subtitleType) => {
    if (true) {
      if (typeof Typed === 'function') {
        subtitleType()
      } else {
        getScript('https://cdn.jsdelivr.net/npm/typed.js/dist/typed.umd.min.js').then(subtitleType)
      }
    } else {
      subtitleType()
    }
  }
}
</script><script>function subtitleType () {
  if (true) {
    typedJSFn.init(["什么是学习？","观察它的现状","了解它的过去","推测它的未来"])
  } else {
    document.getElementById("subtitle").textContent = "什么是学习？"
  }
}
typedJSFn.run(subtitleType)</script></div><div class="aplayer no-destroy" data-id="8725969824" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>